#!/bin/bash -e

force="no"
function parseOpts() {
for i in $*; do
case $i in
-f|--force)
force="yes"
;;
*)
echo "Unknown flag $i; $0 [-f|--force]" >&2
exit 1
esac
done
}

if [[ "$force" != "yes" && "$UID" != "0" ]]; then
echo "Must be run as root."
exit 1
fi

UNINSTALLER_TMP_FILE=$(mktemp)
UNINSTALLER_FILE=/var/lib/mechanic/uninstall.sh

function checkForTools() {
local path=""
local tool=""

for tool in $*; do
path=$(which $tool)
if [[ -z "$path" ]]; then
echo "$tool not found."
exit 1
fi
done
}

function streamTar() {
(cat - | base64 -d | gzip -d ) <<EOB
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
EOB
}

function checkPreconditions() {
echo "Checking preconditions..."
checkForTools cat tar base64 gzip mktemp sed mv rmdir rm
streamTar | tar tf - | sed -r 's#./(.*)$#/\1#g' | (while read file; do
if [[ "$file" =~ ^.*[^/]$ ]]; then
if [[ -f "$file" ]]; then
echo "$file already exists; aborting."
exit 1
else
echo "$file - ok"
fi
else
echo "$file - ok"
fi
done)
}

function unpack() {
echo "Unpacking..."
streamTar | tar xvf - -C /
}

function generateUninstaller() {
echo "Generating uninstaller..."
streamTar | tar tf - | sort -r | sed -r 's#./(.*)$#/\1#g' | (cat - <<EOB
#!/bin/bash -xe

echo "Uninstalling..."
EOB
while read file; do
if [[ "$file" =~ ^.*/$ ]]; then
if [[ ! -d "$file" ]]; then
echo "rmdir "$file""
fi
else
echo "rm "$file"";
fi
done; cat - <<EOB
echo "Done."

exit 0
EOB
) >$UNINSTALLER_TMP_FILE
}

function relocateUninstaller() {
mv $UNINSTALLER_TMP_FILE $UNINSTALLER_FILE
chmod +x $UNINSTALLER_FILE
}

checkPreconditions
generateUninstaller
unpack
relocateUninstaller

exit 0
