#!/bin/bash -e

if [[ "$UID" != "0" ]]; then
echo "Must be run as root."
exit 1
fi

UNINSTALLER_TMP_FILE=$(mktemp)
UNINSTALLER_FILE=/var/lib/mechanic/uninstall.sh

function checkForTools() {
local path=""
local tool=""

for tool in $*; do
path=$(which $tool)
if [[ -z "$path" ]]; then
echo "$tool not found."
exit 1
fi
done
}

function streamTar() {
(cat - | base64 -d | gzip -d ) <<EOB
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
EOB
}

function checkPreconditions() {
echo "Checking preconditions..."
checkForTools cat tar base64 gzip mktemp sed mv rmdir rm
streamTar | tar tf - | sed -r 's#./(.*)$#/\1#g' | (while read file; do
if [[ "$file" =~ ^.*[^/]$ ]]; then
if [[ -f "$file" ]]; then
echo "$file already exists; aborting."
exit 1
else
echo "$file - ok"
fi
else
echo "$file - ok"
fi
done)
}

function unpack() {
echo "Unpacking..."
streamTar | tar xvf -
}

function generateUninstaller() {
echo "Generating uninstaller..."
streamTar | tar tf - | sort -r | sed -r 's#./(.*)$#/\1#g' | (cat - <<EOB
#!/bin/bash -xe

echo "Uninstalling..."
EOB
while read file; do
if [[ "$file" =~ ^.*/$ ]]; then
if [[ ! -d "$file" ]]; then
echo "rm -r "$file""
fi
else
echo "rm "$file"";
fi
done; cat - <<EOB
echo "Done."

exit 0
EOB
) >$UNINSTALLER_TMP_FILE
}

function relocateUninstaller() {
mv $UNINSTALLER_TMP_FILE $UNINSTALLER_FILE
chmod +x $UNINSTALLER_FILE
}

checkPreconditions
generateUninstaller
unpack
relocateUninstaller

exit 0
