#!/bin/bash -e

force="no"
function parseOpts() {
for i in $*; do
case $i in
-f|--force)
force="yes"
;;
*)
echo "Unknown flag $i; $0 [-f|--force]" >&2
exit 1
esac
done
}

if [[ "$force" != "yes" && "$UID" != "0" ]]; then
echo "Must be run as root."
exit 1
fi

UNINSTALLER_TMP_FILE=$(mktemp)
UNINSTALLER_FILE=/var/lib/mechanic/uninstall.sh

function checkForTools() {
local path=""
local tool=""

for tool in $*; do
path=$(which $tool)
if [[ -z "$path" ]]; then
echo "$tool not found."
exit 1
fi
done
}

function streamTar() {
(cat - | base64 -d | gzip -d ) <<EOB
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
qUxJ6f8D7HMfyQCQAQA=
EOB
}

function checkPreconditions() {
echo "Checking preconditions..."
checkForTools cat tar base64 gzip mktemp sed mv rmdir rm
streamTar | tar tf - | sed -r 's#./(.*)$#/\1#g' | (while read file; do
if [[ "$file" =~ ^.*[^/]$ ]]; then
if [[ -f "$file" ]]; then
echo "$file already exists; aborting."
exit 1
else
echo "$file - ok"
fi
else
echo "$file - ok"
fi
done)
}

function unpack() {
echo "Unpacking..."
streamTar | tar xvf - -C /
}

function generateUninstaller() {
echo "Generating uninstaller..."
streamTar | tar tf - | sort -r | sed -r 's#./(.*)$#/\1#g' | (cat - <<EOB
#!/bin/bash -xe

echo "Uninstalling..."
EOB
while read file; do
if [[ "$file" =~ ^.*/$ ]]; then
if [[ ! -d "$file" ]]; then
echo "rmdir "$file""
fi
else
echo "rm "$file"";
fi
done; cat - <<EOB
echo "Done."

exit 0
EOB
) >$UNINSTALLER_TMP_FILE
}

function relocateUninstaller() {
mv $UNINSTALLER_TMP_FILE $UNINSTALLER_FILE
chmod +x $UNINSTALLER_FILE
}

checkPreconditions
generateUninstaller
unpack
relocateUninstaller

exit 0
