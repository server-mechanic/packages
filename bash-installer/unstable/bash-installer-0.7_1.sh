#!/bin/bash -e

if [[ "$UID" != "0" ]]; then
echo "Must be run as root."
exit 1
fi

UNINSTALLER_TMP_FILE=$(mktemp)
UNINSTALLER_FILE=/var/lib/mechanic/uninstall.sh

function checkForTools() {
local path=""
local tool=""

for tool in $*; do
path=$(which $tool)
if [[ -z "$path" ]]; then
echo "$tool not found."
exit 1
fi
done
}

function streamTar() {
(cat - | base64 -d | gzip -d ) <<EOB
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
qlSlKlWpSlWqUpWqVKUqVWmV9L85cOlGAGgBAA==
EOB
}

function checkPreconditions() {
echo "Checking preconditions..."
checkForTools cat tar base64 gzip mktemp sed mv rmdir rm
streamTar | tar tf - | sed -r 's#./(.*)$#/\1#g' | (while read file; do
if [[ "$file" =~ ^.*[^/]$ ]]; then
if [[ -f "$file" ]]; then
echo "$file already exists; aborting."
exit 1
else
echo "$file - ok"
fi
else
echo "$file - ok"
fi
done)
}

function unpack() {
echo "Unpacking..."
streamTar | tar xvf - -C /
}

function generateUninstaller() {
echo "Generating uninstaller..."
streamTar | tar tf - | sort -r | sed -r 's#./(.*)$#/\1#g' | (cat - <<EOB
#!/bin/bash -xe

echo "Uninstalling..."
EOB
while read file; do
if [[ "$file" =~ ^.*/$ ]]; then
if [[ ! -d "$file" ]]; then
echo "rmdir "$file""
fi
else
echo "rm "$file"";
fi
done; cat - <<EOB
echo "Done."

exit 0
EOB
) >$UNINSTALLER_TMP_FILE
}

function relocateUninstaller() {
mv $UNINSTALLER_TMP_FILE $UNINSTALLER_FILE
chmod +x $UNINSTALLER_FILE
}

checkPreconditions
generateUninstaller
unpack
relocateUninstaller

exit 0
