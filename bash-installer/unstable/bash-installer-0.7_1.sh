#!/bin/bash -e

if [[ "$UID" != "0" ]]; then
echo "Must be run as root."
exit 1
fi

UNINSTALLER_TMP_FILE=$(mktemp)
UNINSTALLER_FILE=/var/lib/mechanic/uninstall.sh

function checkForTools() {
local path=""
local tool=""

for tool in $*; do
path=$(which $tool)
if [[ -z "$path" ]]; then
echo "$tool not found."
exit 1
fi
done
}

function streamTar() {
(cat - | base64 -d | gzip -d ) <<EOB
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
EOB
}

function checkPreconditions() {
echo "Checking preconditions..."
checkForTools cat tar base64 gzip mktemp sed mv rmdir rm
streamTar | tar tf - | sed -r 's#./(.*)$#/\1#g' | (while read file; do
if [[ "$file" =~ ^.*[^/]$ ]]; then
if [[ -f "$file" ]]; then
echo "$file already exists; aborting."
exit 1
else
echo "$file - ok"
fi
else
echo "$file - ok"
fi
done)
}

function unpack() {
echo "Unpacking..."
streamTar | tar xvf - -C /
}

function generateUninstaller() {
echo "Generating uninstaller..."
streamTar | tar tf - | sort -r | sed -r 's#./(.*)$#/\1#g' | (cat - <<EOB
#!/bin/bash -xe

echo "Uninstalling..."
EOB
while read file; do
if [[ "$file" =~ ^.*/$ ]]; then
if [[ ! -d "$file" ]]; then
echo "rm -r "$file""
fi
else
echo "rm "$file"";
fi
done; cat - <<EOB
echo "Done."

exit 0
EOB
) >$UNINSTALLER_TMP_FILE
}

function relocateUninstaller() {
mv $UNINSTALLER_TMP_FILE $UNINSTALLER_FILE
chmod +x $UNINSTALLER_FILE
}

checkPreconditions
generateUninstaller
unpack
relocateUninstaller

exit 0
